services:
  todoendpoint:
    build:
      context: ../../TodoEndpoint
    image: todoendpoint
    container_name: todoendpoint
    ports:
      - "5000:80"
    environment:
      - todoui=http://todoui:5000
      - todoui_map=/
      #- todoapi=http://todoapi:5000/api/todoitems
      #- todoapi_map=/api/todoitems
    depends_on:
      - todoui

  todoui:
    build:
      context: ../../TodoUI
    image: todoui
    container_name: todoui
    #ports: # For Debug
    #  - "5001:5000"
    environment:
      - urls=http://*:5000
      - todoapi=http://todoapi:5000/api/todoitems
    depends_on:
      - todoapi

  todoapi:
    build:
      context: ../../TodoApi
    image: todoapi
    container_name: todoapi
    #ports: # For Debug
    #  - "5002:5000"
    environment:
      - urls=http://*:5000
      - Provider=MySQL
      - ConnectionStrings__MySQL=Server=tododb;Database=todoapi;User=todoapi;Password=todoapi;
      - ConnectionStrings__PostgreSQL=Host=tododb;Port=5432;User Id=todoapi;Password=todoapi;Database=todoapi;
      - ConnectionStrings__SQLServer=Server=tododb;Database=todoapi;User Id=sa;Password=Xt0d0ap!;
      - ConnectionStrings__SQLite=Filename=DB/todoapi.db
    depends_on:
      - tododb

  tododb:
    image: mariadb
    container_name: tododb
    volumes:
      - type: volume
        source: tododb-data
        target: /var/lib/mysql
    environment:
      - MYSQL_ROOT_PASSWORD=todoapi
      - MYSQL_DATABASE=todoapi
      - MYSQL_USER=todoapi
      - MYSQL_PASSWORD=todoapi

  tododb-console:
    image: adminer
    container_name: tododb-console
    ports:
      - "8080:8080"
    environment:
      - ADMINER_DEFAULT_SERVER=tododb
    depends_on:
      - tododb


volumes:
  tododb-data:
    name: tododb-data
